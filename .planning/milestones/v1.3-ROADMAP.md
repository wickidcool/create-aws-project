# Roadmap: v1.3.0 CLI Architecture Refactor

**Milestone:** v1.3.0
**Created:** 2026-01-21
**Status:** In Progress

## Overview

Refactor CLI architecture to separate project generation from AWS/GitHub setup. Main wizard becomes lean (project scaffolding only), with AWS Organizations and GitHub setup extracted into dedicated post-install commands (`setup-aws-envs` and `initialize-github <env>`).

## Phases

### Phase 4: CLI Infrastructure & Command Routing

**Goal:** CLI routes commands correctly and validates project context

**Dependencies:** None (foundation)

**Requirements:**
- CLI-01: CLI entry point routes to correct command based on arguments
- CLI-02: Commands detect when not run from inside valid project directory
- CLI-03: Existing `setup-github` command removed/deprecated

**Success Criteria:**
1. User runs `npx create-aws-project` and gets main wizard (backward compatibility maintained)
2. User runs `setup-aws-envs` from inside project and command executes
3. User runs `initialize-github dev` from inside project and command executes
4. User runs `setup-aws-envs` from outside project and gets clear error message
5. User tries to run old `setup-github` command and gets deprecation notice

---

### Phase 5: Wizard Simplification

**Goal:** Main wizard is lean and generates project config

**Dependencies:** Phase 4 (needs CLI routing)

**Requirements:**
- WIZ-01: Main wizard only prompts for project name, platforms, auth, features, region, theme
- WIZ-02: AWS Organizations prompts removed from main wizard flow
- WIZ-03: Generated project includes config file for post-install commands to read

**Success Criteria:**
1. User runs wizard and only sees prompts for project name, platforms, auth, features, region, theme
2. User completes wizard without seeing AWS Organizations prompts
3. Generated project contains `.aws-starter-config.json` with project settings
4. Config file includes project name, selected platforms, auth provider, region, theme

---

### Phase 6: setup-aws-envs Command

**Goal:** Users can set up AWS Organizations from generated project

**Dependencies:** Phase 5 (needs project config)

**Requirements:**
- AWS-01: User can run `setup-aws-envs` from inside generated project
- AWS-02: Command creates AWS Organization if not exists
- AWS-03: Command creates environment accounts (dev, stage, prod)
- AWS-04: Command stores account IDs in project config for other commands
- AWS-05: Command shows progress and handles errors gracefully

**Success Criteria:**
1. User runs `setup-aws-envs` and sees progress indicator for each step
2. Command creates AWS Organization (or confirms existing)
3. Command creates three environment accounts (dev, stage, prod)
4. Config file updates with account IDs after successful creation
5. User sees clear error message if AWS permissions insufficient

---

### Phase 7: initialize-github Command

**Goal:** Users can initialize GitHub environments per-environment

**Dependencies:** Phase 6 (needs account IDs from AWS setup)

**Requirements:**
- GH-01: User can run `initialize-github <env>` from inside generated project
- GH-02: Command accepts environment name as required argument (dev, stage, prod)
- GH-03: Command creates IAM deployment user for specified environment
- GH-04: Command configures GitHub Environment with AWS credentials
- GH-05: Command validates environment exists in project config before proceeding

**Success Criteria:**
1. User runs `initialize-github dev` and environment gets configured
2. User runs `initialize-github prod` separately and prod environment gets configured
3. Command creates IAM deployment user for specified environment
4. Command configures GitHub Environment with AWS credentials
5. User runs `initialize-github invalid` and gets validation error

---

### Phase 8: Documentation Updates

**Goal:** README and docs reflect new CLI architecture

**Dependencies:** Phase 7 (all commands implemented)

**Requirements:**
- DOC-01: README.md updated with new CLI commands and usage
- DOC-02: Wizard prompts section reflects simplified flow (no AWS Organizations)
- DOC-03: Post-install setup workflow documented (setup-aws-envs → initialize-github)

**Success Criteria:**
1. README shows new commands: `setup-aws-envs`, `initialize-github <env>`
2. Wizard prompts section no longer mentions AWS Organizations
3. Clear post-install workflow: generate → setup-aws-envs → initialize-github dev/stage/prod
4. Examples show complete setup flow

---

## Progress

| Phase | Requirements | Plans | Status | Completed |
|-------|--------------|-------|--------|-----------|
| 4. CLI Infrastructure & Command Routing | 3 | 2/2 | Complete | 2026-01-22 |
| 5. Wizard Simplification | 3 | 2/2 | Complete | 2026-01-21 |
| 6. setup-aws-envs Command | 5 | TBD | Pending | — |
| 7. initialize-github Command | 5 | TBD | Pending | — |
| 8. Documentation Updates | 3 | TBD | Pending | — |

**Total:** 5 phases, 19 requirements

---
*Roadmap created: 2026-01-21*
*Last updated: 2026-01-21*

## Completed Phases

### Phase 4 (Complete)
- CLI-01: COMPLETE - CLI routes commands via switch statement
- CLI-02: COMPLETE - requireProjectContext() validates project directory
- CLI-03: COMPLETE - setup-github shows deprecation notice

### Phase 5 (Complete)
- WIZ-01: COMPLETE - Wizard prompts only for 7 items (name, platforms, auth, features, region, theme)
- WIZ-02: COMPLETE - AWS Organizations prompts removed from wizard
- WIZ-03: COMPLETE - Generated project includes .aws-starter-config.json

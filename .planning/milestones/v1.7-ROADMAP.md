# Milestone v1.7: AI-Friendly CLI

**Status:** SHIPPED 2026-02-19
**Phases:** 23-25
**Total Plans:** 4

## Overview

Enable AI coding agents to drive the CLI non-interactively via a config file, with sensible defaults for all optional values. Both `create-aws-project` and `setup-aws-envs` support `--config <path>` for fully automated project generation and AWS setup.

## Phases

### Phase 23: Template Fix: Configurable Auth Test Mock

**Goal**: App.spec.tsx test mock correctly handles authenticated vs unauthenticated states without spurious fetch calls.
**Depends on**: None
**Plans**: 0 plans (already implemented)
**Requirements**: FIX-01

**Details:**
Already implemented before milestone planning. The App.spec.tsx template mock was updated to support configurable auth state, allowing tests to control whether fetch is triggered on mount based on authentication status.

---

### Phase 24: Non-Interactive Wizard Mode

**Goal**: The create-aws-project CLI can run entirely without user input by reading a JSON config file, enabling AI agents and CI pipelines to generate projects programmatically.
**Depends on**: Phase 23
**Plans**: 2 plans
**Requirements**: NI-01, NI-02, NI-03, NI-04, NI-05, NI-06

Plans:

- [x] 24-01: TDD: Non-interactive config schema + loader (Zod schema, defaults, validation, tests)
- [x] 24-02: Wire --config flag into CLI (detection, runNonInteractive, skip git, E2E verification)

**Details:**
- Zod v4 schema (`NonInteractiveConfigSchema`) validates all wizard fields in one pass
- `loadNonInteractiveConfig()` reads JSON file, validates, returns typed `ProjectConfig`
- Only `name` is required; all other fields default to wizard defaults
- Invalid config produces clear error listing all validation failures, exits non-zero
- `--config` flag detected in `runCreate()`, routes to `runNonInteractive()`
- Git setup skipped entirely in non-interactive mode
- `process.exit(0)` at end of non-interactive path prevents fallthrough

**Success Criteria (all verified):**
1. `--config project.json` with `{"name": "my-app"}` generates project with all defaults
2. Complete config file produces project with every specified value applied
3. Invalid config prints clear error listing every validation failure, exits non-zero
4. `--config` does not perform git init or GitHub repo setup

---

### Phase 25: Non-Interactive setup-aws-envs

**Goal**: setup-aws-envs can run without user input by reading a JSON config file, deriving per-environment emails automatically from a single root email address.
**Depends on**: Phase 24
**Plans**: 2 plans
**Requirements**: NI-07, NI-08, NI-09

Plans:

- [x] 25-01: TDD: Config schema + email derivation (Zod schema, loader, deriveEnvironmentEmails, tests)
- [x] 25-02: Wire --config into setup-aws-envs (detection, non-interactive flow, auto GitHub setup)

**Details:**
- `SetupAwsEnvsConfigSchema` with single required `email` field
- `deriveEnvironmentEmails()` uses `lastIndexOf('@')` to insert `-{env}` before `@`
- `runSetupAwsEnvsNonInteractive()` runs full AWS flow (org, accounts, IAM, CDK bootstrap) without prompts
- Auto-invokes `runInitializeGitHub(['--all'])` after AWS success
- GitHub failure produces warning only (AWS setup already succeeded)
- Interactive path completely unchanged — no regression

**Success Criteria (all verified):**
1. `setup-aws-envs --config aws.json` with `{"email": "owner@example.com"}` completes full AWS setup with no prompts
2. Per-environment emails auto-derived: `owner-dev@example.com`, `owner-stage@example.com`, `owner-prod@example.com`
3. Running without `--config` continues to prompt interactively

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**

- Use z.object() not z.strictObject() for config schemas (strip unknown keys silently)
- Silently drop authFeatures when auth=none (no-op for automation pipelines)
- Dual name validation: Zod min(1) + validateProjectName() for npm rules
- z.enum(VALID_REGIONS) not z.string().refine() for cleaner errors
- Detect --config inside command functions (runCreate, runSetupAwsEnvs) not run()
- printWelcome() before --config check for consistent UX
- process.exit(0) at end of non-interactive functions
- z.string().min(1) not z.email() for setup-aws-envs email (AWS validates authoritatively)
- Post-safeParse includes('@') check for email format
- lastIndexOf('@') for email splitting (defensive for edge cases)
- GitHub failure uses console.warn not handleAwsError (best-effort, not critical)

**Issues Resolved:**

- App.spec.tsx template test mock now supports configurable auth state
- Non-interactive mode prevents accidental git setup for AI-driven workflows

**Issues Deferred:**

- Non-interactive initialize-github (NI-EXT-01) — deferred to future milestone
- JSON output mode for structured AI-readable output (NI-EXT-02)
- CLI flags as alternative to config file (NI-EXT-03)

**Technical Debt Incurred:**

- process.exit(1) inside runInitializeGitHub bypasses try/catch in non-interactive flow (documented as known limitation)
- Unusual flag ordering (`create-aws-project --config aws.json setup-aws-envs`) drops --config flag (documented form works correctly)

---

_For current project status, see .planning/ROADMAP.md_

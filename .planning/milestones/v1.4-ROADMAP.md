# Milestone v1.4: Generated Project Validation

**Status:** ✅ SHIPPED 2026-01-24
**Phases:** 10-14
**Total Plans:** 5

## Overview

Milestone v1.4 builds a test harness that validates all 14 generated project configurations (7 platform combinations x 2 auth providers) actually compile and pass tests. The harness generates projects into isolated temp directories, runs the npm install/build/test pipeline, and reports results. Local developers run via npm script; CI runs tiered execution (core configs on PRs, full matrix on releases).

## Phases

### Phase 10: Test Harness Foundation

**Goal:** Developers can create isolated temp directories and execute npm commands with captured output
**Depends on:** Nothing (first phase of v1.4)
**Requirements:** HARN-02, HARN-05
**Plans:** 1 plan

Plans:
- [x] 10-01-PLAN.md — Test harness utilities (withTempDir, runCommand)

**Key Files:**
- src/__tests__/harness/temp-dir.ts
- src/__tests__/harness/run-command.ts

**Decisions:**
- Try-finally cleanup pattern for guaranteed temp directory removal
- Warn-don't-throw on cleanup failure to avoid masking test errors
- Interleaved output capture with execa all:true
- Structured CommandResult interface

### Phase 11: Validation Pipeline

**Goal:** Single function validates a generated project through the full npm lifecycle
**Depends on:** Phase 10
**Requirements:** HARN-01, HARN-03, HARN-04, REPT-03
**Plans:** 1 plan

Plans:
- [x] 11-01-PLAN.md — Validation pipeline with timeout support and step tracking

**Key Files:**
- src/__tests__/harness/validate-project.ts

**Decisions:**
- 10-minute default timeout per step
- Fail-fast behavior (stop at first failing step)
- timedOut detection for debugging hanging processes

### Phase 12: Test Fixtures and Matrix

**Goal:** Test configurations are defined as typed factories with tiered execution support
**Depends on:** Phase 11
**Requirements:** CICD-03
**Plans:** 1 plan

Plans:
- [x] 12-01-PLAN.md — Config factories and tiered test matrix

**Key Files:**
- src/__tests__/harness/fixtures/config-factories.ts
- src/__tests__/harness/fixtures/matrix.ts

**Decisions:**
- Tier distribution: smoke (1), core (4), full (9) for balanced coverage vs speed
- Core tier covers all 3 platforms AND both auth providers in 5 configs
- Exclude 'none' auth provider from matrix

### Phase 13: Reporting and Local Runner

**Goal:** Developers can run validation locally with clear progress and summary output
**Depends on:** Phase 12
**Requirements:** REPT-01, REPT-02, REPT-04, REPT-05
**Plans:** 1 plan

Plans:
- [x] 13-01-PLAN.md — Local runner with spinner progress and npm scripts

**Key Files:**
- src/__tests__/harness/local-runner.ts

**Decisions:**
- CI detection for progress (TTY spinners for local, plain logging for CI)
- Use npm install not npm ci (generated projects lack package-lock.json)
- Use build:all script (matches Nx monorepo structure)

### Phase 14: CI Integration

**Goal:** CI automatically validates core configs on PRs and full matrix on releases
**Depends on:** Phase 13
**Requirements:** CICD-01, CICD-02
**Plans:** 1 plan

Plans:
- [x] 14-01-PLAN.md — CI workflows with matrix strategy for PR and release validation

**Key Files:**
- .github/workflows/pr-validation.yml
- .github/workflows/release-validation.yml

**Decisions:**
- PR validation runs core tier (5 configs) for speed (2-3 min)
- Release validation runs full matrix (14 configs) for comprehensive coverage
- fail-fast: false to report all config failures
- ci-complete/release-complete jobs for branch protection integration

---

## Milestone Summary

**Key Decisions:**
- Try-finally cleanup pattern: Guarantee temp directory cleanup even when test throws
- Warn-don't-throw on cleanup failure: Cleanup errors log warnings to avoid masking test failures
- Timeout support: 10-minute default timeout per validation step with timedOut detection
- Fail-fast validation: Stop at first failure (install/build/test) to save time
- Tier distribution: smoke (1), core (4), full (9) configs for balanced coverage vs speed
- CI detection for progress: TTY spinners for local dev, plain logging for CI
- Single config execution for CI matrix: npm run test:e2e -- config-name

**Issues Resolved:**
- Template TypeScript errors (TS4111 index signature issues) discovered and fixed by validation harness
- Jest testMatch config fixed to only run .spec.ts files
- npm ci → npm install for generated projects without lockfile
- build → build:all for Nx monorepo structure

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- runValidationSuite not exported from local-runner.ts (low severity, non-blocking)

---

*For current project status, see .planning/ROADMAP.md*

---
*Archived: 2026-01-24 as part of v1.4 milestone completion*

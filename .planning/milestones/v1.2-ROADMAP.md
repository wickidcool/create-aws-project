# Milestone v1.2: AWS Organizations Support

**Status:** SHIPPED 2026-01-20
**Phases:** 1-3
**Total Plans:** 8

## Overview

Version 1.2.0 adds AWS Organizations support with automatic creation of dev/stage/prod accounts, plus a new CLI command for configuring GitHub Actions deployment credentials. The work progresses from AWS infrastructure setup, to GitHub integration tooling, to template updates that tie everything together.

## Phases

### Phase 1: AWS Organizations Foundation

**Goal**: Users can opt into AWS Organizations during project generation, with automatic creation of Organization and environment accounts (dev, stage, prod)
**Depends on**: Nothing (first phase)
**Plans**: 3 plans

Plans:
- [x] 01-01: Add org structure wizard prompts and types
- [x] 01-02: AWS Organizations SDK integration and account creation
- [x] 01-03: CLI integration and template tokens

**Key files:**
- `src/types.ts` - OrgConfig and OrgAccount types
- `src/prompts/org-structure.ts` - Organization wizard prompts
- `src/aws/organizations.ts` - AWS Organizations SDK integration
- `src/templates/tokens.ts` - Token derivation with org account IDs

### Phase 2: GitHub Deployment Command

**Goal**: New CLI command (`setup-github` or similar) that creates IAM deployment users per environment and configures GitHub repository secrets
**Depends on**: Phase 1
**Plans**: 3 plans in 2 waves

Plans:
- [x] 02-01: IAM SDK module for deployment user creation (Wave 1)
- [x] 02-02: GitHub API module for repository secrets (Wave 1)
- [x] 02-03: CLI command integration with human verification (Wave 2)

**Key files:**
- `src/aws/iam.ts` - IAM deployment user creation
- `src/github/secrets.ts` - GitHub secrets API with tweetnacl encryption
- `src/commands/setup-github.ts` - CLI command module
- `src/prompts/github-setup.ts` - GitHub setup wizard

### Phase 3: Template Updates & Integration

**Goal**: CDK templates support multi-account deployment, GitHub workflows use environment-specific credentials
**Depends on**: Phase 2
**Plans**: 2 plans in 2 waves

Plans:
- [x] 03-01: CDK stack updates for cross-account deployment
- [x] 03-02: GitHub workflow updates for multi-environment secrets

**Key files:**
- `templates/apps/api/cdk/app.ts` - Multi-account CDK app with conditional blocks
- `templates/.github/actions/deploy-cdk/action.yml` - Environment-aware CDK deploy
- `templates/.github/actions/deploy-web/action.yml` - Environment-prefixed exports

---

## Milestone Summary

**Key Decisions:**
- Direct AWS API for org creation (not CDK templates)
- Separate CLI command for GitHub setup
- Three environments: dev, stage, prod
- Sequential account creation due to AWS rate limits
- GitHub Environments for AWS credentials (not suffixed repo secrets)
- tweetnacl for GitHub secrets encryption (lighter than libsodium)
- Handlebars conditionals for ORG_ENABLED backward compatibility

**Issues Resolved:**
- None

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_

---
phase: 05-wizard-simplification
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli.ts
autonomous: true

must_haves:
  truths:
    - "Project creation no longer attempts AWS Organizations setup"
    - "Generated project contains .aws-starter-config.json with project settings"
    - "Post-wizard messaging includes setup-aws-envs as next step"
  artifacts:
    - path: "src/cli.ts"
      provides: "Simplified runCreate flow with config file write"
      contains: "writeConfigFile"
      not_contains: "createOrganizationsClient"
  key_links:
    - from: "src/cli.ts"
      to: "node:fs"
      via: "writeFileSync import"
      pattern: "writeFileSync.*from.*node:fs"
    - from: "writeConfigFile"
      to: ".aws-starter-config.json"
      via: "file write"
      pattern: "aws-starter-config\\.json"
---

<objective>
Modify cli.ts to remove AWS Organizations setup and add config file generation

Purpose: The CLI should generate a config file that downstream commands (setup-aws-envs, initialize-github) can read. AWS Organizations setup moves to setup-aws-envs command.

Output: cli.ts without org setup code, with config file write, with updated next steps messaging
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-wizard-simplification/05-CONTEXT.md
@.planning/phases/05-wizard-simplification/05-RESEARCH.md
@src/cli.ts
@src/utils/project-context.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove AWS Organizations setup from cli.ts</name>
  <files>src/cli.ts</files>
  <action>
Remove AWS Organizations functionality from cli.ts:

1. Remove imports from './aws/organizations.js':
   - createOrganizationsClient
   - checkExistingOrganization
   - createOrganization
   - createEnvironmentAccounts

2. Remove the entire AWS Organizations setup block in runCreate() (lines 121-209):
   - The `if (config.org?.enabled)` block
   - All organization client creation
   - All organization/account creation logic
   - All error handling for AWS Organizations

After removal, runCreate() should flow directly from:
   `const config = await runWizard();`
   (null check)
   `const outputDir = resolve(process.cwd(), config.projectName);`

Keep all other imports and logic unchanged.
  </action>
  <verify>
TypeScript compiles: `npm run build`
No references to organizations.js remain in cli.ts
  </verify>
  <done>
cli.ts has no AWS Organizations imports or setup code
  </done>
</task>

<task type="auto">
  <name>Task 2: Add config file generation to cli.ts</name>
  <files>src/cli.ts</files>
  <action>
Add config file generation after project creation:

1. Add writeFileSync to the existing node:fs import:
   `import { readFileSync, existsSync, mkdirSync, writeFileSync } from 'node:fs';`

2. Add AwsStarterConfig interface (before functions or with other types):
```typescript
/**
 * Config file structure for .aws-starter-config.json
 */
interface AwsStarterConfig {
  configVersion: string;
  projectName: string;
  platforms: string[];
  authProvider: string;
  features: string[];
  awsRegion: string;
  theme: string;
  createdAt: string;
  accounts: Record<string, string>;
}
```

3. Add writeConfigFile function:
```typescript
/**
 * Write project configuration file for downstream commands
 */
function writeConfigFile(outputDir: string, config: ProjectConfig): void {
  const configContent: AwsStarterConfig = {
    configVersion: '1.0',
    projectName: config.projectName,
    platforms: config.platforms,
    authProvider: config.auth.provider,
    features: config.features,
    awsRegion: config.awsRegion,
    theme: config.brandColor,
    createdAt: new Date().toISOString(),
    accounts: {},
  };

  const configPath = join(outputDir, '.aws-starter-config.json');
  writeFileSync(configPath, JSON.stringify(configContent, null, 2), 'utf-8');
}
```

4. Call writeConfigFile in runCreate() after generateProject():
```typescript
await generateProject(config, outputDir);

// Write config file for downstream commands
writeConfigFile(outputDir, config);
```

5. Import ProjectConfig type if not already imported:
   Check if ProjectConfig is used elsewhere in file; if not, import from './types.js'
  </action>
  <verify>
Build succeeds: `npm run build`
Manually test: run wizard, check .aws-starter-config.json exists in generated project
  </verify>
  <done>
cli.ts has writeConfigFile function, calls it after project generation
  </done>
</task>

<task type="auto">
  <name>Task 3: Update printNextSteps with setup-aws-envs guidance</name>
  <files>src/cli.ts</files>
  <action>
Add setup-aws-envs guidance to post-wizard messaging:

1. In printNextSteps function, add setup-aws-envs instruction at the end (before "Happy coding!"):

```typescript
// After the platform-specific blocks (web, mobile, api)...

// Add setup-aws-envs guidance
console.log(`  ${pc.gray('# Configure AWS environments')}`);
console.log(`  ${pc.cyan('npx create-aws-project setup-aws-envs')}`);
console.log('');

console.log(pc.gray('Happy coding!'));
```

2. The final output should look like:
```
Next steps:

  cd my-project
  npm install

  # Start web app
  npm run web

  # Configure AWS environments
  npx create-aws-project setup-aws-envs

Happy coding!
```

Note: This appears inline at the end of next steps, not as a prominent separate section (per CONTEXT.md decision).
  </action>
  <verify>
Build succeeds: `npm run build`
Manually test: run wizard, verify "Configure AWS environments" appears in next steps
  </verify>
  <done>
printNextSteps includes setup-aws-envs guidance after platform commands
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. Grep verification: `grep -c "createOrganizationsClient" src/cli.ts` returns 0
3. Grep verification: `grep -c "writeConfigFile" src/cli.ts` returns 2+ (definition + call)
4. Grep verification: `grep -c "setup-aws-envs" src/cli.ts` returns 1+ (in printNextSteps)
5. Integration test (optional): Create test project, verify .aws-starter-config.json exists and contains expected fields
</verification>

<success_criteria>
- cli.ts has no imports from './aws/organizations.js'
- cli.ts has no config.org?.enabled check in runCreate()
- cli.ts has AwsStarterConfig interface
- cli.ts has writeConfigFile function
- writeConfigFile is called after generateProject in runCreate()
- printNextSteps includes setup-aws-envs guidance
- npm run build succeeds
- Generated projects contain .aws-starter-config.json with all expected fields
</success_criteria>

<output>
After completion, create `.planning/phases/05-wizard-simplification/05-02-SUMMARY.md`
</output>

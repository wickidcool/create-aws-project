---
phase: 12-test-fixtures-and-matrix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/__tests__/harness/fixtures/config-factories.ts
  - src/__tests__/harness/fixtures/matrix.ts
  - src/__tests__/harness/fixtures/index.ts
  - src/__tests__/harness/fixtures/fixtures.spec.ts
autonomous: true

must_haves:
  truths:
    - "Factory functions return valid ProjectConfig objects"
    - "TEST_MATRIX contains exactly 14 configurations"
    - "All 7 platform combinations are covered"
    - "Both auth providers (cognito, auth0) are covered"
    - "Core tier covers all platforms and both auth providers"
    - "getConfigsByTier returns correct config counts per tier"
  artifacts:
    - path: "src/__tests__/harness/fixtures/config-factories.ts"
      provides: "14 factory functions for each platform/auth combination"
      exports: ["createWebCognitoConfig", "createWebAuth0Config", "createMobileCognitoConfig", "createMobileAuth0Config", "createApiCognitoConfig", "createApiAuth0Config", "createWebMobileCognitoConfig", "createWebMobileAuth0Config", "createWebApiCognitoConfig", "createWebApiAuth0Config", "createMobileApiCognitoConfig", "createMobileApiAuth0Config", "createFullStackCognitoConfig", "createFullStackAuth0Config"]
    - path: "src/__tests__/harness/fixtures/matrix.ts"
      provides: "TEST_MATRIX array and tier selection helpers"
      exports: ["TEST_MATRIX", "TestTier", "TestConfiguration", "getConfigsByTier", "getConfigByName"]
    - path: "src/__tests__/harness/fixtures/index.ts"
      provides: "Public exports for fixtures module"
    - path: "src/__tests__/harness/fixtures/fixtures.spec.ts"
      provides: "Tests verifying matrix coverage and factory validity"
      min_lines: 60
  key_links:
    - from: "src/__tests__/harness/fixtures/matrix.ts"
      to: "src/__tests__/harness/fixtures/config-factories.ts"
      via: "import * as factories"
      pattern: "import.*config-factories"
    - from: "src/__tests__/harness/fixtures/config-factories.ts"
      to: "src/types.ts"
      via: "ProjectConfig type import"
      pattern: "import.*ProjectConfig.*types"
---

<objective>
Create typed configuration factories and test matrix with tiered execution support for all 14 generated project configurations.

Purpose: Provide test fixtures that Phase 13 (reporting) and Phase 14 (CI integration) will use to run validation against different platform/auth combinations. Core tier ensures PR validation covers all critical paths without running all 14 configs.

Output: Factory functions for 14 configs, TEST_MATRIX with tier assignments, tier selection helpers, and tests verifying coverage.
</objective>

<execution_context>
@/Users/alwick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alwick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-test-fixtures-and-matrix/12-RESEARCH.md
@src/types.ts
@src/__tests__/harness/validate-project.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create config factories and matrix definition</name>
  <files>
    src/__tests__/harness/fixtures/config-factories.ts
    src/__tests__/harness/fixtures/matrix.ts
    src/__tests__/harness/fixtures/index.ts
  </files>
  <action>
Create the fixtures directory and three files following the research patterns exactly:

**config-factories.ts:**
- Import `ProjectConfig`, `AuthProvider`, `BrandColor` from `../../../types.js`
- Create internal `ConfigOverrides` interface for type safety
- Create internal `createBaseConfig(overrides)` function that returns a fresh ProjectConfig with defaults:
  - projectName: from overrides or 'test-project'
  - platforms: from overrides or ['web', 'api']
  - awsRegion: 'us-east-1'
  - features: [] (empty array)
  - brandColor: 'blue'
  - auth.provider: from overrides or 'cognito'
  - auth.features: [] (empty for validation - not testing auth features)
- Export 14 factory functions, one for each platform/auth combination:
  - Single platform (6): createWebCognitoConfig, createWebAuth0Config, createMobileCognitoConfig, createMobileAuth0Config, createApiCognitoConfig, createApiAuth0Config
  - Double platform (6): createWebMobileCognitoConfig, createWebMobileAuth0Config, createWebApiCognitoConfig, createWebApiAuth0Config, createMobileApiCognitoConfig, createMobileApiAuth0Config
  - Triple platform (2): createFullStackCognitoConfig, createFullStackAuth0Config
- Each factory sets unique projectName (e.g., 'test-web-cognito') to avoid collisions

**matrix.ts:**
- Import `ProjectConfig` from `../../../types.js`
- Import all factories from `./config-factories.js`
- Export `TestTier` type: `'smoke' | 'core' | 'full'`
- Export `TestConfiguration` interface: `{ name: string; config: ProjectConfig; tier: TestTier; }`
- Export `TEST_MATRIX: TestConfiguration[]` with all 14 configs:
  - Smoke tier (1): web-api-cognito (most common default)
  - Core tier (4): web-cognito, mobile-auth0, api-cognito, full-auth0 (covers all platforms + both auth)
  - Full tier (9): remaining configurations
- Export `getConfigsByTier(tier: TestTier): TestConfiguration[]`:
  - 'smoke' returns only smoke configs (1)
  - 'core' returns smoke + core configs (5)
  - 'full' returns all configs (14)
- Export `getConfigByName(name: string): TestConfiguration` that throws if not found

**index.ts:**
- Re-export everything from config-factories.js
- Re-export everything from matrix.js
  </action>
  <verify>
Run TypeScript compilation: `npx tsc --noEmit`
Import test: `node -e "import('./src/__tests__/harness/fixtures/index.js').then(m => console.log('Exports:', Object.keys(m).length))"`
  </verify>
  <done>
- 14 factory functions exported from config-factories.ts
- TEST_MATRIX exported with 14 configs
- getConfigsByTier and getConfigByName exported from matrix.ts
- All exports re-exported from index.ts
- TypeScript compilation passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Add comprehensive test coverage</name>
  <files>
    src/__tests__/harness/fixtures/fixtures.spec.ts
  </files>
  <action>
Create test file following Jest patterns from existing tests in the project:

**Test imports:**
- Import `describe, it, expect` from `@jest/globals`
- Import `TEST_MATRIX, getConfigsByTier, getConfigByName` from `./matrix.js`

**Test structure:**

describe('Test Fixtures', () => {

  describe('TEST_MATRIX', () => {
    - it('should define exactly 14 configurations')
    - it('should have unique names for all configurations')
    - it('should have unique project names for all configurations')
    - it('should cover all 7 platform combinations') - extract platforms, sort, join, check unique count is 7
    - it('should cover both auth providers (cognito, auth0)')
    - it('should not include auth provider none')
  });

  describe('getConfigsByTier', () => {
    - it('should return 1 config for smoke tier')
    - it('should return 5 configs for core tier (smoke + core)')
    - it('should return all 14 configs for full tier')
    - it('core tier should include at least one config per platform') - check web, mobile, api present
    - it('core tier should include at least one config per auth provider') - check cognito, auth0 present
  });

  describe('getConfigByName', () => {
    - it('should return config when name exists')
    - it('should throw when name does not exist')
  });

  describe('Config validity', () => {
    - it.each(TEST_MATRIX)('$name should have valid ProjectConfig structure', ({config})) - check required fields present and valid values
  });

});
  </action>
  <verify>
Run tests: `npm test -- --testPathPattern=fixtures.spec`
All tests should pass.
  </verify>
  <done>
- fixtures.spec.ts contains tests for matrix, tier selection, and config validity
- All tests pass
- Tests verify: 14 configs, unique names, 7 platforms, both auth providers, tier counts, core coverage
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Lint passes: `npm run lint`
3. All tests pass: `npm test`
4. Fixture tests specifically pass: `npm test -- --testPathPattern=fixtures`
</verification>

<success_criteria>
- [ ] 14 factory functions exist and return valid ProjectConfig objects
- [ ] TEST_MATRIX contains exactly 14 configurations with descriptive names
- [ ] Configurations tagged with tier (smoke: 1, core: 4, full: 9)
- [ ] Core tier includes web, mobile, api platforms AND cognito, auth0 providers
- [ ] getConfigsByTier('smoke') returns 1, 'core' returns 5, 'full' returns 14
- [ ] All tests pass (existing 91+ fixture tests)
</success_criteria>

<output>
After completion, create `.planning/phases/12-test-fixtures-and-matrix/12-01-SUMMARY.md`
</output>

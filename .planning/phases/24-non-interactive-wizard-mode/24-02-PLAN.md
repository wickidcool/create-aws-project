---
phase: 24-non-interactive-wizard-mode
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - src/cli.ts
autonomous: true

must_haves:
  truths:
    - "Running with `--config project.json` generates a project from the config file with no interactive prompts"
    - "Running with `--config project.json` does NOT call promptGitSetup() or setupGitRepository()"
    - "Running with `--config` but no path argument prints an error and exits non-zero"
    - "Running without `--config` continues to run the interactive wizard (no regression)"
    - "Running with `--config` when target directory already exists prints an error and exits non-zero"
  artifacts:
    - path: "src/cli.ts"
      provides: "--config detection, runNonInteractive() function, non-interactive create path"
      contains: "runNonInteractive"
  key_links:
    - from: "src/cli.ts"
      to: "src/config/non-interactive.ts"
      via: "imports loadNonInteractiveConfig"
      pattern: "loadNonInteractiveConfig"
    - from: "src/cli.ts"
      to: "src/generator/index.ts"
      via: "calls generateProject with loaded config"
      pattern: "generateProject"
---

<objective>
Wire the `--config` flag into the CLI so that `npx create-aws-project --config project.json` runs the full non-interactive create flow: load config, validate, generate project, skip git setup.

Purpose: This completes NI-01 (--config flag), NI-02 (no prompts), and NI-06 (skip git setup). After this plan, the entire Phase 24 is functional end-to-end.
Output: Updated `src/cli.ts` with `--config` detection and `runNonInteractive()` function.
</objective>

<execution_context>
@/Users/alwick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alwick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-non-interactive-wizard-mode/24-RESEARCH.md
@.planning/phases/24-non-interactive-wizard-mode/24-01-SUMMARY.md

@src/cli.ts
@src/config/non-interactive.ts
@src/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add --config detection and runNonInteractive() to cli.ts</name>
  <files>src/cli.ts</files>
  <action>
1. Add import at top of `src/cli.ts`:
```typescript
import { loadNonInteractiveConfig } from './config/non-interactive.js';
```

2. Inside `runCreate(args)`, add `--config` detection BEFORE the existing `nameArg` line. The detection goes right after `printWelcome()` and the blank line:

```typescript
async function runCreate(args: string[]): Promise<void> {
  printWelcome();
  console.log('');

  // Non-interactive path: --config flag provided
  const configFlagIndex = args.findIndex(arg => arg === '--config');
  if (configFlagIndex !== -1) {
    const configPath = args[configFlagIndex + 1];
    if (!configPath || configPath.startsWith('--')) {
      console.error(pc.red('Error:') + ' --config requires a path argument');
      console.error('  Example: npx create-aws-project --config project.json');
      process.exit(1);
    }
    await runNonInteractive(configPath);
    return;
  }

  // Interactive path (unchanged — existing code below)
  const nameArg = args.find(arg => !arg.startsWith('-'));
  // ... rest of existing runCreate unchanged
}
```

3. Add `runNonInteractive()` function (add it before `runCreate` or after it, alongside other functions):

```typescript
/**
 * Run project creation in non-interactive mode from a JSON config file.
 * Skips all prompts and git setup (NI-02, NI-06).
 */
async function runNonInteractive(configPath: string): Promise<void> {
  const config = loadNonInteractiveConfig(configPath);
  const outputDir = resolve(process.cwd(), config.projectName);

  // Check if directory already exists
  if (existsSync(outputDir)) {
    console.error(pc.red('Error:') + ` Directory ${pc.cyan(config.projectName)} already exists.`);
    process.exit(1);
  }

  // Create project directory
  mkdirSync(outputDir, { recursive: true });

  // Generate project
  console.log('');
  await generateProject(config, outputDir);

  // Write config file for downstream commands
  writeConfigFile(outputDir, config);

  // NI-06: Skip git setup entirely in non-interactive mode
  // promptGitSetup() is NOT called

  // Success message and next steps
  console.log('');
  console.log(pc.green('✔') + ` Created ${pc.bold(config.projectName)} successfully!`);
  printNextSteps(config.projectName);
  process.exit(0);
}
```

4. Update `printHelp()` to document the `--config` flag. Add to the Options section:
```
  --config <path>     Create project from JSON config file (non-interactive)
```
And add a usage example:
```
  create-aws-project --config project.json    Non-interactive mode
```

5. Run `npm run build` to verify TypeScript compiles.
6. Run `npm test` to verify no regressions.
7. Commit: `feat(24-02): wire --config flag into CLI for non-interactive mode`
  </action>
  <verify>
1. `npm run build` — compiles without errors
2. `npm test` — all tests pass (no regressions)
3. Manual verification: Create a temp `test-config.json` with `{"name":"test-ni-app"}`, run `node dist/index.js --config test-config.json`, verify project directory created with defaults, no prompts shown. Clean up after.
  </verify>
  <done>
`src/cli.ts` contains `runNonInteractive()`. The `--config` flag is detected in `runCreate()` and branches to the non-interactive path. Git setup is skipped. Help text documents the new flag. Build passes, all tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: End-to-end verification of all Phase 24 success criteria</name>
  <files></files>
  <action>
Run four end-to-end checks matching the Phase 24 success criteria from ROADMAP.md:

**Check 1 (SC-1, minimal config with defaults):**
```bash
echo '{"name":"sc1-test"}' > /tmp/sc1-config.json
node dist/index.js --config /tmp/sc1-config.json
```
Verify: Directory `sc1-test` created. Check `.aws-starter-config.json` inside it confirms: platforms=web,api; authProvider=none; features=github-actions,vscode-config; awsRegion=us-east-1; theme=blue. Clean up: `rm -rf sc1-test /tmp/sc1-config.json`.

**Check 2 (SC-2, complete config with all values):**
```bash
echo '{"name":"sc2-test","platforms":["web","mobile","api"],"auth":"cognito","authFeatures":["social-login"],"features":["github-actions"],"region":"eu-west-1","brandColor":"purple"}' > /tmp/sc2-config.json
node dist/index.js --config /tmp/sc2-config.json
```
Verify: Directory `sc2-test` created. `.aws-starter-config.json` has all specified values. No prompts appeared. Clean up.

**Check 3 (SC-3, invalid config exits non-zero):**
```bash
echo '{"platforms":["invalid"]}' > /tmp/sc3-config.json
node dist/index.js --config /tmp/sc3-config.json; echo "Exit: $?"
```
Verify: Exit code is non-zero. Error output lists validation failures for `name` and `platforms`. No prompts appeared. No directory created. Clean up.

**Check 4 (SC-4, no git operations):**
Confirm by reading the `runNonInteractive` code that `promptGitSetup()` and `setupGitRepository()` are NOT called anywhere in the non-interactive path. This is a code inspection check.

Report results of all 4 checks. If any fail, fix and re-verify.
  </action>
  <verify>
All four success criteria pass. The phase goal is achieved: the CLI runs entirely without user input when given `--config`.
  </verify>
  <done>
Phase 24 success criteria verified end-to-end. Non-interactive mode works for minimal configs, complete configs, invalid configs, and correctly skips git setup.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — TypeScript compiles
2. `npm test` — all tests pass (unit tests from Plan 01 + existing tests)
3. SC-1: `--config` with `{"name":"x"}` generates project with defaults
4. SC-2: `--config` with full config applies all values
5. SC-3: `--config` with invalid data exits non-zero with error list
6. SC-4: `--config` does not call promptGitSetup or setupGitRepository
</verification>

<success_criteria>
- `src/cli.ts` detects `--config` flag and routes to `runNonInteractive()`
- Non-interactive path calls `loadNonInteractiveConfig()` then `generateProject()` then `writeConfigFile()`
- Non-interactive path does NOT call `runWizard()`, `promptGitSetup()`, or `setupGitRepository()`
- Help text documents `--config` flag
- All 4 Phase 24 success criteria verified end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/24-non-interactive-wizard-mode/24-02-SUMMARY.md`
</output>

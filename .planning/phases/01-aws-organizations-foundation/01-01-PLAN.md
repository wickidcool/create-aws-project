---
phase: 01-aws-organizations-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/types.ts, src/prompts/org-structure.ts, src/wizard.ts]
autonomous: true
---

<objective>
Add AWS Organizations wizard prompts and configuration types.

Purpose: Enable users to opt into multi-account AWS Organizations setup during project generation, collecting organization name and environment account email addresses.
Output: New org-structure types, prompt module, and updated wizard flow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/types.ts
@src/wizard.ts
@src/prompts/auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AWS Organizations types to types.ts</name>
  <files>src/types.ts</files>
  <action>
Add new types for AWS Organizations configuration:

1. Add `OrgAccountConfig` interface with:
   - `environment: string` (flexible environment name - e.g., 'dev', 'stage', 'prod', 'qa', 'sandbox')
   - `email: string` (root email for the account)
   - `accountId?: string` (populated after creation)

2. Add `OrgConfig` interface with:
   - `enabled: boolean`
   - `organizationName: string`
   - `accounts: OrgAccountConfig[]` (flexible array - user chooses which environments)

3. Update `ProjectConfig` interface to add:
   - `org?: OrgConfig` (optional to maintain backward compatibility)

Follow existing patterns: use interfaces for objects, export all types.
Note: Using string for environment (not union type) allows flexibility for custom environment names.
  </action>
  <verify>npm run build succeeds with no TypeScript errors</verify>
  <done>OrgConfig, OrgAccountConfig types exported from types.ts. ProjectConfig includes optional org field. Supports flexible environment names.</done>
</task>

<task type="auto">
  <name>Task 2: Create org-structure prompts module</name>
  <files>src/prompts/org-structure.ts</files>
  <action>
Create new prompt module following existing patterns (see auth.ts for reference):

1. `enableOrgPrompt: PromptObject` - select prompt:
   - message: "Set up AWS Organizations with separate accounts per environment?"
   - choices: Yes (value: true), No (value: false)
   - initial: 1 (No by default - opt-in feature)
   - hint: "- Creates separate AWS accounts for each environment"

2. `orgNamePrompt: PromptObject` - text prompt:
   - type: conditional on enableOrg being true (use `(prev) => prev ? 'text' : null`)
   - message: "Organization name:"
   - initial: derive from projectName if available via `(_, values) => values.projectName + '-org'`
   - validate: non-empty string

3. `orgEnvironmentsPrompt: PromptObject` - multiselect prompt:
   - type: conditional on enableOrg being true
   - message: "Select environments to create accounts for:"
   - choices:
     - { title: 'dev', value: 'dev', selected: true }
     - { title: 'stage', value: 'stage', selected: true }
     - { title: 'prod', value: 'prod', selected: true }
     - { title: 'qa', value: 'qa', selected: false }
     - { title: 'sandbox', value: 'sandbox', selected: false }
   - hint: "- Space to toggle, Enter to confirm"
   - min: 1 (at least one environment required)

4. Create a helper function `createEmailPromptsForEnvironments()` that generates email prompts dynamically based on selected environments. However, since prompts library doesn't support fully dynamic prompts, use a workaround:
   - Create `orgAccountEmailsPrompt: PromptObject` as a text prompt
   - type: conditional on enableOrg
   - message: "Enter root emails for each environment (comma-separated in order):"
   - hint: shows selected environments, e.g., "- Order: dev, stage, prod"
   - validate: correct number of emails matching selected environments

Alternatively (simpler approach): Keep individual email prompts for the common environments (dev, stage, prod) with conditional display based on whether that environment was selected. Skip prompts for unselected environments.

Use picocolors for consistent styling with other prompts. Export all prompts.
  </action>
  <verify>npm run build succeeds. All prompts are exported.</verify>
  <done>Org prompts created with multiselect for environment selection. Email collection handles variable number of environments.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate org prompts into wizard.ts</name>
  <files>src/wizard.ts</files>
  <action>
Update wizard to include org prompts:

1. Import all org prompts from './prompts/org-structure.js'

2. Add org prompts to the prompts array AFTER awsRegionPrompt (logical grouping - AWS region first, then org structure):
   - enableOrgPrompt
   - orgNamePrompt
   - orgEnvironmentsPrompt
   - Email prompts for selected environments

3. Update the response processing to construct OrgConfig:
   - If response.enableOrg is true, create OrgConfig object with:
     - enabled: true
     - organizationName: response.orgName
     - accounts: array of OrgAccountConfig objects for each selected environment with their emails

4. Add `org` field to returned ProjectConfig (only if enabled)

5. No changes to validation - org is optional, so missing org fields don't fail the wizard.

Maintain backward compatibility: if enableOrg is false/undefined, org field is omitted from ProjectConfig.
  </action>
  <verify>npm run build succeeds. npm test passes (existing wizard tests should still pass).</verify>
  <done>Wizard prompts for org setup with flexible environment selection, conditionally constructs OrgConfig when enabled, backward compatible with existing flow.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all existing tests
- [ ] Types are properly exported from types.ts
- [ ] Prompts follow existing patterns (check auth.ts for reference)
- [ ] Conditional prompt logic works (org prompts only show when enabled)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Types properly defined for org configuration
- Prompts conditionally display based on user choice
- Wizard constructs OrgConfig when org is enabled
- Backward compatible - existing projects without org work unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/01-aws-organizations-foundation/01-01-SUMMARY.md`
</output>

---
phase: 01-aws-organizations-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/types.ts, src/prompts/org-structure.ts, src/wizard.ts]
autonomous: true
---

<objective>
Add AWS Organizations wizard prompts and configuration types.

Purpose: Enable users to opt into multi-account AWS Organizations setup during project generation, collecting organization name and environment account email addresses.
Output: New org-structure types, prompt module, and updated wizard flow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/types.ts
@src/wizard.ts
@src/prompts/auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AWS Organizations types to types.ts</name>
  <files>src/types.ts</files>
  <action>
Add new types for AWS Organizations configuration:

1. Add `OrgEnvironment` type: `'dev' | 'stage' | 'prod'`

2. Add `OrgAccountConfig` interface with:
   - `environment: OrgEnvironment`
   - `email: string` (root email for the account)
   - `accountId?: string` (populated after creation)

3. Add `OrgConfig` interface with:
   - `enabled: boolean`
   - `organizationName: string`
   - `accounts: OrgAccountConfig[]`

4. Update `ProjectConfig` interface to add:
   - `org?: OrgConfig` (optional to maintain backward compatibility)

Follow existing patterns: use type unions for enums, interfaces for objects, export all types.
  </action>
  <verify>npm run build succeeds with no TypeScript errors</verify>
  <done>OrgConfig, OrgAccountConfig, OrgEnvironment types exported from types.ts. ProjectConfig includes optional org field.</done>
</task>

<task type="auto">
  <name>Task 2: Create org-structure prompts module</name>
  <files>src/prompts/org-structure.ts</files>
  <action>
Create new prompt module following existing patterns (see auth.ts for reference):

1. `enableOrgPrompt: PromptObject` - select prompt:
   - message: "Set up AWS Organizations with separate accounts per environment?"
   - choices: Yes (value: true), No (value: false)
   - initial: 1 (No by default - opt-in feature)
   - hint: "- Creates dev, stage, prod accounts under one organization"

2. `orgNamePrompt: PromptObject` - text prompt:
   - type: conditional on enableOrg being true (use `(prev) => prev ? 'text' : null`)
   - message: "Organization name:"
   - initial: derive from projectName if available via `(_, values) => values.projectName + '-org'`
   - validate: non-empty string

3. `devAccountEmailPrompt: PromptObject` - text prompt:
   - type: conditional on enableOrg
   - message: "Root email for dev account:"
   - hint: "- Must be unique email not used by another AWS account"
   - validate: basic email format check

4. `stageAccountEmailPrompt: PromptObject` - same pattern for stage

5. `prodAccountEmailPrompt: PromptObject` - same pattern for prod

Use picocolors for consistent styling with other prompts. Export all prompts.
  </action>
  <verify>npm run build succeeds. All prompts are exported.</verify>
  <done>Five org-related prompts created and exported. Conditional logic shows prompts only when org is enabled.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate org prompts into wizard.ts</name>
  <files>src/wizard.ts</files>
  <action>
Update wizard to include org prompts:

1. Import all org prompts from './prompts/org-structure.js'

2. Add org prompts to the prompts array AFTER awsRegionPrompt (logical grouping - AWS region first, then org structure):
   - enableOrgPrompt
   - orgNamePrompt
   - devAccountEmailPrompt
   - stageAccountEmailPrompt
   - prodAccountEmailPrompt

3. Update the response processing to construct OrgConfig:
   - If response.enableOrg is true, create OrgConfig object with:
     - enabled: true
     - organizationName: response.orgName
     - accounts: array of three OrgAccountConfig objects for dev/stage/prod with emails

4. Add `org` field to returned ProjectConfig (only if enabled)

5. No changes to validation - org is optional, so missing org fields don't fail the wizard.

Maintain backward compatibility: if enableOrg is false/undefined, org field is omitted from ProjectConfig.
  </action>
  <verify>npm run build succeeds. npm test passes (existing wizard tests should still pass).</verify>
  <done>Wizard prompts for org setup, conditionally constructs OrgConfig when enabled, backward compatible with existing flow.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all existing tests
- [ ] Types are properly exported from types.ts
- [ ] Prompts follow existing patterns (check auth.ts for reference)
- [ ] Conditional prompt logic works (org prompts only show when enabled)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Types properly defined for org configuration
- Prompts conditionally display based on user choice
- Wizard constructs OrgConfig when org is enabled
- Backward compatible - existing projects without org work unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/01-aws-organizations-foundation/01-01-SUMMARY.md`
</output>

---
phase: 01-aws-organizations-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [package.json, src/aws/organizations.ts]
autonomous: true
---

<objective>
Add AWS Organizations SDK integration for creating organizations and accounts.

Purpose: Provide the core AWS API functionality to create an Organization and member accounts programmatically during project generation.
Output: AWS Organizations service module with createOrganization and createAccount functions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@package.json
@src/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AWS SDK Organizations dependency</name>
  <files>package.json</files>
  <action>
Add @aws-sdk/client-organizations as a production dependency:

1. Add to dependencies section: `"@aws-sdk/client-organizations": "^3.700.0"`

2. Run npm install to update package-lock.json

Note: Use ^3.700.0 or later to ensure compatibility with latest AWS SDK v3 patterns. This is a runtime dependency (not devDependency) because the CLI needs it to call AWS APIs during project generation.
  </action>
  <verify>npm install succeeds. package.json shows @aws-sdk/client-organizations in dependencies.</verify>
  <done>AWS SDK Organizations client added as dependency and installed.</done>
</task>

<task type="auto">
  <name>Task 2: Create AWS Organizations service module</name>
  <files>src/aws/organizations.ts</files>
  <action>
Create new module at src/aws/organizations.ts:

1. Import from @aws-sdk/client-organizations:
   - OrganizationsClient
   - CreateOrganizationCommand
   - CreateAccountCommand
   - DescribeCreateAccountStatusCommand
   - ListAccountsCommand

2. Create `createOrganizationsClient(region: string)` function:
   - Returns configured OrganizationsClient
   - Region defaults to 'us-east-1' (Organizations API is global but accessed via us-east-1)

3. Create `checkExistingOrganization(client: OrganizationsClient)` function:
   - Uses DescribeOrganization to check if org exists
   - Returns organization ID if exists, null if not
   - Used to skip creation if already in an org

4. Create `createOrganization(client: OrganizationsClient)` function:
   - Calls CreateOrganizationCommand with FeatureSet: 'ALL'
   - Returns organization ID
   - Handles error if organization already exists (not an error for our flow)

5. Create `createAccount(client: OrganizationsClient, email: string, accountName: string)` function:
   - Calls CreateAccountCommand with email and accountName
   - Returns CreateAccountStatus ID for polling

6. Create `waitForAccountCreation(client: OrganizationsClient, createAccountRequestId: string, timeoutMs: number = 300000)` function:
   - Polls DescribeCreateAccountStatusCommand every 5 seconds
   - Returns account ID when State is 'SUCCEEDED'
   - Throws error if State is 'FAILED' (include FailureReason)
   - Times out after timeoutMs (default 5 minutes)

7. Create `createEnvironmentAccounts(client: OrganizationsClient, orgName: string, accounts: Array<{environment: string, email: string}>)` function:
   - Creates accounts sequentially (AWS has rate limits on concurrent account creation)
   - Account names: `${orgName}-${environment}` (e.g., "myapp-org-dev")
   - Returns array of {environment, email, accountId}
   - Provides console output for progress (using picocolors)

Export all public functions. Use async/await throughout. Handle AWS errors gracefully with meaningful messages.

IMPORTANT: Do NOT use deprecated Status field - use State field per AWS 2026 deprecation notice.
  </action>
  <verify>npm run build succeeds. TypeScript compiles without errors.</verify>
  <done>Organizations service module created with createOrganization, createAccount, and waitForAccountCreation functions. Uses AWS SDK v3 patterns.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm install` succeeds
- [ ] `npm run build` succeeds without errors
- [ ] @aws-sdk/client-organizations is in package.json dependencies
- [ ] src/aws/organizations.ts compiles without TypeScript errors
- [ ] All functions are exported
- [ ] Uses State field (not deprecated Status field)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- AWS SDK client properly configured
- Account creation polling implemented with timeout
- Progress feedback provided to user via console
- Error handling includes meaningful messages
</success_criteria>

<output>
After completion, create `.planning/phases/01-aws-organizations-foundation/01-02-SUMMARY.md`
</output>

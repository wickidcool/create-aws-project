---
phase: 21-fix-aws-github-setup
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - src/commands/setup-aws-envs.ts
autonomous: true

must_haves:
  truths:
    - "setup-aws-envs offers a continuation prompt after successful completion"
    - "Accepting continuation runs initialize-github --all inline"
    - "Declining continuation shows helpful next-step message with --all flag"
  artifacts:
    - path: "src/commands/setup-aws-envs.ts"
      provides: "Continuation prompt to GitHub setup"
      contains: "Continue to GitHub Environment setup"
  key_links:
    - from: "src/commands/setup-aws-envs.ts"
      to: "src/commands/initialize-github.ts#runInitializeGitHub"
      via: "direct function import and call with ['--all'] args"
      pattern: "runInitializeGitHub\\(\\['--all'\\]\\)"
---

<objective>
Add a continuation prompt at the end of `setup-aws-envs` that offers to run `initialize-github --all` directly, eliminating the need for users to manually invoke a separate command.

Purpose: Currently `setup-aws-envs` completes and prints "Next: npx create-aws-project initialize-github dev" — the user must context-switch and run a new command. By offering inline continuation, the entire AWS -> GitHub flow becomes seamless (2 confirmations instead of 4 commands).

Output: Modified `setup-aws-envs.ts` with continuation prompt at the end of successful setup.
</objective>

<execution_context>
@/Users/alwick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alwick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-fix-aws-github-setup/21-RESEARCH.md
@.planning/phases/21-fix-aws-github-setup/21-01-SUMMARY.md
@src/commands/setup-aws-envs.ts
@src/commands/initialize-github.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add continuation prompt to setup-aws-envs</name>
  <files>src/commands/setup-aws-envs.ts</files>
  <action>
Modify the end of `runSetupAwsEnvs` in `src/commands/setup-aws-envs.ts` to add a continuation prompt after the success summary.

**1. Add import for `runInitializeGitHub`:**

At the top of the file, add:
```typescript
import { runInitializeGitHub } from './initialize-github.js';
```

**2. Replace the "Next steps" section at the end of the try block:**

Currently the function ends with:
```typescript
console.log('Next: Push credentials to GitHub:');
console.log(`  ${pc.cyan('npx create-aws-project initialize-github dev')}`);
```

Replace this section (everything after the "AWS setup complete" CDK message) with a continuation prompt:

```typescript
// Offer continuation to GitHub setup
const continueResponse = await prompts(
  {
    type: 'confirm',
    name: 'continueToGitHub',
    message: 'Continue to GitHub Environment setup?',
    initial: true,
  },
  {
    onCancel: () => {
      // User pressed Ctrl+C — show next step hint and exit gracefully
      console.log('');
      console.log('Next: Push credentials to GitHub:');
      console.log(`  ${pc.cyan('npx create-aws-project initialize-github --all')}`);
    },
  }
);

if (continueResponse.continueToGitHub) {
  console.log('');
  await runInitializeGitHub(['--all']);
} else {
  console.log('');
  console.log('Next: Push credentials to GitHub:');
  console.log(`  ${pc.cyan('npx create-aws-project initialize-github --all')}`);
}
```

**Important constraints:**
- The prompt uses `prompts` library which is already imported in the file
- Use `type: 'confirm'` with `initial: true` (default yes — the natural next step)
- `onCancel` handles Ctrl+C gracefully (show hint message, don't crash)
- Call `runInitializeGitHub(['--all'])` directly (function import, NOT subprocess spawn)
- The summary table and CDK bootstrap message MUST remain above the continuation prompt — do not remove or change them
- If the user declines, show `--all` flag (not the old single-env command)
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors (import of runInitializeGitHub resolves).
Run `npm test` — all existing tests pass.
Read the code and confirm:
  - Continuation prompt appears after success summary
  - Accepting calls `runInitializeGitHub(['--all'])`
  - Declining shows `initialize-github --all` hint
  - Ctrl+C in prompt is handled gracefully
  </verify>
  <done>
`setup-aws-envs` offers "Continue to GitHub Environment setup?" after successful completion.
Accepting runs `initialize-github --all` inline (single PAT prompt, all environments).
Declining shows helpful next-step message with `--all` flag.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm test` passes with no regressions
3. Code review confirms:
   - `runInitializeGitHub` is imported from `./initialize-github.js`
   - Continuation prompt appears after success summary
   - Default is `true` (yes)
   - `onCancel` handles Ctrl+C without crash
   - Accepting calls `runInitializeGitHub(['--all'])`
   - Declining prints `initialize-github --all` hint
   - No circular dependencies (setup-aws-envs imports from initialize-github, not vice versa)
</verification>

<success_criteria>
- Continuation prompt appears at end of successful setup-aws-envs
- User can accept and initialize-github runs inline with --all
- User can decline and gets helpful next-step message
- Ctrl+C handled gracefully
- No circular imports
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/21-fix-aws-github-setup/21-02-SUMMARY.md`
</output>
